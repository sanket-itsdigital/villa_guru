{% load static %} {% block content %}

<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <!-- start page title -->
      <div class="row">
        <div class="col-12">
          <div
            class="page-title-box d-sm-flex align-items-center justify-content-between"
          >
            {% if request.user.is_superuser %}

            <h4 class="mb-sm-0 font-size-18">Admin Dashboard</h4>

            {% else %}

            <h4 class="mb-sm-0 font-size-18">Partner Dashboard</h4>

            {% endif %}
          </div>
        </div>
      </div>
      <!-- end page title -->

      <!-- Messages -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      <div class="row">
        <div class="col-xl-3 col-md-6">
          <!-- card -->
          <div class="card card-h-100">
            <!-- card body -->
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <span class="text-muted mb-3 lh-1 d-block text-truncate"
                    >Total Booking</span
                  >
                  <h4 class="mb-3">
                    <span
                      class="counter-value"
                      data-target="{{ bookings_count }}"
                      >{{ bookings_count }}</span
                    >
                  </h4>
                  {% comment %}
                  <div class="text-nowrap">
                    <span class="badge bg-soft-success text-success"
                      >+₹20.9k</span
                    >
                    <span class="ms-1 text-muted font-size-13"
                      >Since last week</span
                    >
                  </div>
                  {% endcomment %}
                </div>

                <div class="flex-shrink-0 text-end dash-widget">
                  <div
                    id="mini-chart1"
                    data-colors='["#780000; !important ;", "#F0D28C"]'
                    class="apex-charts"
                  ></div>
                </div>
              </div>
            </div>
            <!-- end card body -->
          </div>
          <!-- end card -->
        </div>
        <!-- end col -->

        {% if request.user.is_superuser %}
        <div class="col-xl-3 col-md-6">
          <!-- card -->
          <div class="card card-h-100">
            <!-- card body -->
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <span class="text-muted mb-3 lh-1 d-block text-truncate"
                    >Villa</span
                  >
                  <h4 class="mb-3">
                    <span class="counter-value" data-target="{{ hotels_count }}"
                      >{{ hotels_count }}</span
                    >
                  </h4>
                  {% comment %}
                  <div class="text-nowrap">
                    <span class="badge bg-soft-danger text-danger">-Temp</span>
                    <span class="ms-1 text-muted font-size-13"
                      >Since last week</span
                    >
                  </div>
                  {% endcomment %}
                </div>
                <div class="flex-shrink-0 text-end dash-widget">
                  <div
                    id="mini-chart2"
                    data-colors='["#780000; !important ;", "#F0D28C"]'
                    class="apex-charts"
                  ></div>
                </div>
              </div>
            </div>
            <!-- end card body -->
          </div>
          <!-- end card -->
        </div>
        <!-- end col-->
        {% endif %}

        <div class="col-xl-3 col-md-6">
          <!-- card -->
          <div class="card card-h-100">
            <!-- card body -->
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <span class="text-muted mb-3 lh-1 d-block text-truncate"
                    >Total Collection</span
                  >
                  <h4 class="mb-3">
                    ₹<span
                      class="counter-value"
                      data-target="{{ total_collection }}"
                      >{{ total_collection }}</span
                    >
                  </h4>
                  <div class="text-nowrap">
                    <span class="badge bg-soft-success text-success"
                      >+ {{ percentage_change }}</span
                    >
                    <span class="ms-1 text-muted font-size-13"
                      >Since last week</span
                    >
                  </div>
                </div>
                <div class="flex-shrink-0 text-end dash-widget">
                  <div
                    id="mini-chart3"
                    data-colors='["#780000; !important ;", "#F0D28C"]'
                    class="apex-charts"
                  ></div>
                </div>
              </div>
            </div>
            <!-- end card body -->
          </div>
          <!-- end card -->
        </div>
        <!-- end col -->

        {% if request.user.is_superuser %}

        <div class="col-xl-3 col-md-6">
          <!-- card -->
          <div class="card card-h-100">
            <!-- card body -->
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <span class="text-muted mb-3 lh-1 d-block text-truncate"
                    >Cities</span
                  >
                  <h4 class="mb-3">
                    <span class="counter-value" data-target="{{ city_count }}"
                      >{{ city_count }}</span
                    >
                  </h4>
                  {% comment %}
                  <div class="text-nowrap">
                    <span class="badge bg-soft-success text-success"
                      >+{{ percentage_change }}%</span
                    >
                    <span class="ms-1 text-muted font-size-13"
                      >Since last week</span
                    >
                  </div>
                  {% endcomment %}
                </div>
                <div class="flex-shrink-0 text-end dash-widget">
                  <div
                    id="mini-chart4"
                    data-colors='["#780000; !important ;", "#F0D28C"]'
                    class="apex-charts"
                  ></div>
                </div>
              </div>
            </div>
            <!-- end card body -->
          </div>
          <!-- end card -->
        </div>
        <!-- end col -->

        {% endif %}
      </div>
      <!-- end row-->

      <div class="row">
        <div class="col-xl-8">
          <!-- card -->
          <div class="card">
            <!-- card body -->
            <div class="card-body">
              <div class="d-flex flex-wrap align-items-center mb-4">
                <h5 class="card-title me-2">Market Overview</h5>
                {% comment %} <div class="ms-auto">
                  <div>
                    <button type="button" class="btn btn-soft-primary btn-sm">
                      ALL
                    </button>
                    <button type="button" class="btn btn-soft-secondary btn-sm">
                      1M
                    </button>
                    <button type="button" class="btn btn-soft-secondary btn-sm">
                      6M
                    </button>
                    <button
                      type="button"
                      class="btn btn-soft-secondary btn-sm active"
                    >
                      1Y
                    </button>
                  </div>
                </div> {% endcomment %}
              </div>

              <div class="row align-items-center">
                <div class="col-xl-8">
                  <div>
                    <div
                      id="market-overview"
                      data-colors='["#780000; !important ;", "#F0D28C"]'
                      class="apex-charts"
                    ></div>
                  </div>
                </div>
                <div class="col-xl-4">
                  <div class="p-4">
                    <div class="mt-4 pt-2">
                      {% comment %} <a
                        href="{% url 'list_villa' %}"
                        class="btn btn-primary w-100"
                        style="background-color: #780000; !important ;"
                        >See All Villa Booking
                        <i class="mdi mdi-arrow-right ms-1"></i
                      ></a> {% endcomment %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- end card -->
          </div>
          <!-- end col -->
        </div>
        <!-- end row-->
       

      <!-- end row-->
    </div>
    <!-- container-fluid -->
  </div>
  <!-- End Page-content -->

  {% block footer %} {% include 'partials/footer.html'%} {% endblock footer %}
</div>
<!-- end main content-->
{% endblock content %} {% block extra_js %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
      var options = {
          chart: {
              height: 350,
              type: "line",  // ensure this is 'line'
              toolbar: { show: false }
          },
          series: [{
              name: "Bookings",
              type: "line",  // explicitly set type here too
              data: {{ bookings|safe }}
          }],
          xaxis: {
              categories: {{ months|safe }},
          },
          stroke: {
              curve: "smooth",  // or "straight"
              width: 3          // ensures line is visible
          },
          markers: {
              size: 5,
              colors: ['#495057'],  // optional: marker color
              strokeColors: "#fff",
              strokeWidth: 2
          },
          colors: ['#495057'],  // line color
          tooltip: {
              shared: true,
              intersect: false
          }
      };

      var chart = new ApexCharts(document.querySelector("#market-overview"), options);
      chart.render();
  });
</script>

{% endblock extra_js %}
