{% extends "partials/adminBase.html" %} {% load static %} {% block title %}Add
Villa{% endblock title %} {% block extra_css %}

<link
  href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
  rel="stylesheet"
/>

<!-- plugin css -->
<link
  href="{% static 'libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}"
  rel="stylesheet"
  type="text/css"
/>
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<style>
  body {
    background-color: #f0d28c;
    padding-bottom: 20px;
  }

  .form-container {
    background-color: #ffffff;
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .form-heading {
    text-align: left;
    margin-bottom: 20px;
    font-weight: bold;
    font-size: 2rem;
    color: #780000 !important ;
  }

  .description-box {
    height: 150px;
    resize: none;
  }

  .image-preview {
    max-height: 100px;
    margin-top: 10px;
  }

  .btn-primary {
    background-color: #780000 !important ;
    border-color: #780000 !important ;
  }

  .custom-button {
    width: 150px;
  }

  .select2-container--default .select2-selection--multiple {
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.375rem 0.75rem;
    min-height: calc(2.25rem + 2px);
    background-color: white;
  }

  .select2-selection__choice {
    background-color: #0d6efd;
    border: none;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    margin-top: 4px;
  }

  .select2-selection__choice__remove {
    color: white;
    margin-left: 4px;
  }

  .select2-selection__choice__display {
    margin-left: 9px !important;
  }

  .select2-container--default
    .select2-selection--multiple
    .select2-selection__choice__remove {
    background-color: transparent;
    border: none;
    border-right: 1px solid black !important;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    color: black !important;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    padding: 0 4px;
    position: absolute;
    left: 0;
    top: 0;
  }

  .select2-container .select2-selection--multiple .select2-selection__choice {
    background-color: #3fabe1 !important;
    border: 1px solid #3fabe1 !important;
    border-radius: 1px;
    padding: 0 7px;
  }

  .image-gallery {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding-bottom: 10px;
  }

  .image-gallery img {
    height: 80px;
    border-radius: 5px;
    flex-shrink: 0;
  }

  .image-gallery-container {
    position: relative;
    max-width: 100%;
  }

  .see-more-overlay {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 60px;
    background: linear-gradient(to right, transparent, white);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .form-container {
    background-color: #9a5454ff;
    padding: 8px 10px !important;
  }

  .card {
    border-radius: 8px;
    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
  }
</style>
{% endblock extra_css %} {% block content %}

<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <!-- start page title -->
      <div class="row">
        <div class="col-12">
          <div
            class="page-title-box d-sm-flex align-items-center justify-content-between"
          >
            <h4 class="mb-sm-0 font-size-18">My Villa</h4>
            <h4 class="mb-sm-0 font-size-18">Villa ID: {{ data.villa_id }}</h4>

            <!-- Right-side calendar icon -->
            <div class="calendar-icon" style="margin-right: 200px">
              <a href="{% url 'update_villa_availability' %}">
                <img
                  src="{% static 'images/calendar.png' %}"
                  alt="Calendar"
                  style="height: 40px"
                />
              </a>
            </div>
          </div>
        </div>
      </div>

      {% if not data.is_active %}
      <div
        class="alert alert-danger d-flex align-items-center"
        role="alert"
        style="font-weight: 500; font-size: 15px"
      >
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span
          >This villa is <strong>not active yet</strong>. Please wait for admin
          approval.</span
        >
      </div>
      {% endif %}

      <div class="container">
        <div class="form-container">
          <form method="POST" enctype="multipart/form-data">
            <div class="container mt-5">
              <div class="row">
                <!-- Villa Info -->
                <div class="col-md-6">
                  <div class="card shadow-sm mb-4">
                    {% if data %}
                    <p
                      style="margin: auto; padding-top: 10px; font-weight: 800"
                    >
                      Villa
                    </p>
                    <hr style="padding: 0px; margin: 0px; margin-top: 6px" />
                    <div class="mt-2" style="margin: 0 auto">
                      <a href="{% url 'update_villa' data.id %}"
                        ><i
                          class="bi bi-pencil-square text-primary action-icons"
                          title="Edit"
                        ></i
                        >Edit</a
                      >
                    </div>

                    <div class="card-body text-center">
                      <h4>{{ data.name }}</h4>
                      <p class="text-muted">{% if data.city %}{{ data.city.name }}{% else %}No city{% endif %}</p>
                      {% if data.main_image %}
                      <img
                        src="{{ data.main_image.url }}"
                        class="img-fluid rounded mb-3"
                        alt="Villa Image"
                        style="max-height: 200px; width: auto;"
                      />
                      {% endif %}
                      <span
                        class="badge bg-{% if data.is_featured %}success{% else %}secondary{% endif %}"
                      >
                        {% if data.is_featured %}Featured{% else %}Regular{% endif %}
                      </span>
                      <p class="mt-2">
                        <strong>Rating:</strong> {% if data.star_rating %}{{ data.star_rating }}{% else %}None{% endif %} ★<br />
                        <strong>Overall:</strong> {% if data.overall_rating %}{{ data.overall_rating }}{% else %}N/A{% endif %}
                      </p>
                      {% if data.description %}
                      <p>{{ data.description|truncatewords:30 }}</p>
                      {% else %}
                      <p class="text-muted">No description available.</p>
                      {% endif %}
                      {% if data.price_per_night %}
                      <div class="mt-3 p-3" style="background-color: #f8f9fa; border-radius: 5px; border-left: 4px solid #780000;">
                        <p class="mb-2">
                          <strong>Base Price per Night:</strong> <span class="text-primary">₹{{ data.price_per_night }}</span>
                        </p>
                        {% if data.markup_percentage is not None %}
                        <p class="mb-2">
                          <strong>Custom Markup:</strong> <span class="badge bg-info text-dark">{{ data.markup_percentage }}%</span>
                          <small class="text-muted">(Villa-specific)</small>
                        </p>
                        {% else %}
                        <p class="mb-2">
                          <strong>Markup:</strong> <span class="badge bg-secondary">{{ system_settings.price_markup_percentage|default:"0" }}%</span>
                          <small class="text-muted">(System-wide default)</small>
                        </p>
                        {% endif %}
                        <p class="mb-0 mt-2">
                          <strong>Customer Price (with markup):</strong> 
                          <span class="text-success fw-bold fs-5">₹{{ data.get_marked_up_price|default:"N/A" }}</span>
                        </p>
                        {% if data.markup_percentage is not None %}
                        <small class="text-muted">Base: ₹{{ data.price_per_night }} + {{ data.markup_percentage }}% = ₹{{ data.get_marked_up_price|default:"N/A" }}</small>
                        {% endif %}
                      </div>
                      {% endif %}
                    </div>
                  </div>

                  <!-- Villa Gallery Images -->
                  {% if data.images.all %}
                  <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                      <h6 class="mb-0">Gallery Images</h6>
                    </div>
                    <div class="card-body">
                      <div class="image-gallery-container">
                        <div class="image-gallery" id="hotelGallery">
                          {% for image in data.images.all %}
                          <img src="{{ image.image.url }}" alt="Gallery Image" />
                          {% endfor %}
                        </div>
                        {% if data.images.count > 4 %}
                        <div
                          class="see-more-overlay"
                          onclick="scrollGallery('hotelGallery')"
                        >
                          ➡️
                        </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  {% endif %}

                  <!-- Amenities -->
                  <div class="card shadow-sm">
                    <div class="card-header bg-light">
                      <h6 class="mb-0">Amenities</h6>
                    </div>
                    <div class="card-body">
                      {% if data.amenities.all %}
                        {% for amenity in data.amenities.all %}
                        <div class="d-flex align-items-center mb-2">
                          {% if amenity.image %}
                          <img src="{{ amenity.image.url }}" alt="{{ amenity.name }}" style="width: 24px; height: 24px; margin-right: 8px; border-radius: 4px;">
                          {% else %}
                          <span class="text-success me-2">✓</span>
                          {% endif %}
                          <span>{{ amenity.name }}</span>
                        </div>
                        {% endfor %}
                      {% else %}
                        <p class="text-muted mb-0">No amenities available.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <!-- Additional Villa Information -->
                <div class="col-md-8">
                  <div class="card shadow-sm">
                    <div class="card-header bg-light">
                      <h6 class="mb-0">Villa Details</h6>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <p><strong>Property Type:</strong> {% if data.property_type %}{{ data.property_type.name }}{% else %}N/A{% endif %}</p>
                          <p><strong>Category:</strong> {% if data.category %}{{ data.get_category_display }}{% else %}N/A{% endif %}</p>
                          <p><strong>Address:</strong> {% if data.address %}{{ data.address }}{% else %}N/A{% endif %}</p>
                          {% if data.landmark %}
                          <p><strong>Landmark:</strong> {{ data.landmark }}</p>
                          {% endif %}
                          {% if data.pincode %}
                          <p><strong>Pincode:</strong> {{ data.pincode }}</p>
                          {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                          {% if data.no_of_rooms %}
                          <p><strong>Number of Rooms:</strong> {{ data.no_of_rooms }}</p>
                          {% endif %}
                          {% if data.gst_number %}
                          <p><strong>GST Number:</strong> {{ data.gst_number }}</p>
                          {% endif %}
                          {% if data.pan_number %}
                          <p><strong>PAN Number:</strong> {{ data.pan_number }}</p>
                          {% endif %}
                          <p><strong>Status:</strong> 
                            <span class="badge bg-{% if data.is_active %}success{% else %}secondary{% endif %}">
                              {% if data.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                          </p>
                          <p><strong>Go Live:</strong> 
                            <span class="badge bg-{% if data.go_live %}success{% else %}secondary{% endif %}">
                              {% if data.go_live %}Yes{% else %}No{% endif %}
                            </span>
                          </p>
                        </div>
                      </div>
                      
                      {% if data.description %}
                      <div class="mt-3">
                        <h6>Full Description:</h6>
                        <p>{{ data.description }}</p>
                      </div>
                      {% endif %}

                      {% if data.about %}
                      <div class="mt-3">
                        <h6>About:</h6>
                        <p>{{ data.about }}</p>
                      </div>
                      {% endif %}

                      {% if data.specialties %}
                      <div class="mt-3">
                        <h6>Specialties:</h6>
                        <p>{{ data.specialties }}</p>
                      </div>
                      {% endif %}

                      {% if data.guest_policy %}
                      <div class="mt-3">
                        <h6>Guest Policy:</h6>
                        <p style="white-space: pre-wrap;">{{ data.guest_policy }}</p>
                      </div>
                      {% endif %}

                      {% if data.room_policy %}
                      <div class="mt-3">
                        <h6>Room Policy:</h6>
                        <p style="white-space: pre-wrap;">{{ data.room_policy }}</p>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {% else %}

            <div class="mt-3" style="margin: 0 auto">
              <a href="{% url 'add_villa' %}"
                ><i class="text-primary action-icons" title="Edit"></i>Add
                Villa</a
              >
            </div>

            {% endif %}
          </form>
        </div>
      </div>
    </div>
  </div>

  {% endblock content %} {% block extra_js %}
  <script>
    document.getElementById("id_image").addEventListener("change", function () {
      const file = this.files[0];
      const previewContainer = document.getElementById("imagesPreview");
      previewContainer.innerHTML = "";
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function (event) {
          const img = document.createElement("img");
          img.src = event.target.result;
          img.style.width = "100px";
          img.style.borderRadius = "5px";
          previewContainer.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    $(document).ready(function () {
      $("#id_amenities").select2({
        placeholder: "Select amenities",
        allowClear: true,
      });
    });

    function scrollGallery(id) {
      const gallery = document.getElementById(id);
      if (gallery) {
        gallery.scrollBy({ left: 200, behavior: "smooth" });
      }
    }
  </script>

  {% endblock extra_js %}
</div>
